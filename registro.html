<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - Pastelería Mil Sabores</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="logo">
                    <h1 class="logo-text">Mil Sabores</h1>
                    <span class="logo-subtitle">50 años de tradición</span>
                </div>
                <ul class="nav-menu">
                    <li class="nav-item"><a href="index.html" class="nav-link">Inicio</a></li>
                    <li class="nav-item"><a href="index.html#productos" class="nav-link">Productos</a></li>
                    <li class="nav-item"><a href="index.html#nosotros" class="nav-link">Nosotros</a></li>
                    <li class="nav-item"><a href="index.html#contacto" class="nav-link">Contacto</a></li>
                    <li class="nav-item"><a href="login.html" class="nav-link">Iniciar Sesión</a></li>
                    <li class="nav-item"><a href="carrito.html" class="nav-link cart-link" id="cartBtn"><i class="fas fa-shopping-cart"></i> <span id="cartCount">0</span></a></li>
                </ul>
                <div class="hamburger">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </div>
            </div>
        </nav>
    </header>

    <main class="auth-main">
        <div class="auth-container-page">
            <div class="auth-card">
                <div class="auth-header">
                    <h1>Crear Cuenta</h1>
                    <p>Únete a la familia Mil Sabores y disfruta de descuentos especiales</p>
                </div>
                
                <form id="registerForm" class="auth-form active">
                    <div class="form-group">
                        <label for="fullName">Nombre completo</label>
                        <input type="text" id="fullName" name="fullName" placeholder="Tu nombre completo" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Correo electrónico</label>
                        <input type="email" id="email" name="email" placeholder="tu@email.com" required>
                        <small class="help-text">Usa tu correo @duocuc.cl para beneficios especiales</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="birthDate">Fecha de nacimiento</label>
                        <input type="date" id="birthDate" name="birthDate" required>
                        <small class="help-text">Mayores de 50 años obtienen 50% de descuento</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="promoCode">Código promocional (opcional)</label>
                        <input type="text" id="promoCode" name="promoCode" placeholder="Ej: FELICES50">
                        <small class="help-text">¿Tienes un código especial? ¡Úsalo aquí!</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Contraseña</label>
                        <input type="password" id="password" name="password" placeholder="Mínimo 6 caracteres" required minlength="6">
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">Confirmar contraseña</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Repite tu contraseña" required>
                    </div>
                    
                    <div class="form-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="terms" required>
                            <span class="checkmark"></span>
                            Acepto los <a href="#" class="terms-link">términos y condiciones</a>
                        </label>
                    </div>
                    
                    <div class="discount-info" id="discountInfo" style="display: none;"></div>
                    
                    <button type="submit" class="auth-button">Crear Cuenta</button>
                </form>
                
                <div class="auth-footer">
                    <p>¿Ya tienes una cuenta? <a href="login.html">Iniciar Sesión</a></p>
                </div>
                
                <!-- Información de descuentos disponibles -->
                <div class="discount-cards">
                    <h3>Descuentos Especiales</h3>
                    <div class="discount-grid">
                        <div class="discount-card">
                            <i class="fas fa-birthday-cake"></i>
                            <h4>Mayores de 50</h4>
                            <p>50% de descuento en todos los productos</p>
                        </div>
                        <div class="discount-card">
                            <i class="fas fa-graduation-cap"></i>
                            <h4>Estudiantes Duoc</h4>
                            <p>Torta gratis en tu cumpleaños con correo @duocuc.cl</p>
                        </div>
                        <div class="discount-card">
                            <i class="fas fa-gift"></i>
                            <h4>Código FELICES50</h4>
                            <p>10% de descuento permanente</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Pastelería Mil Sabores</h3>
                    <p>50 años endulzando momentos especiales</p>
                </div>
                <div class="footer-section">
                    <h4>Enlaces Rápidos</h4>
                    <ul>
                        <li><a href="index.html">Inicio</a></li>
                        <li><a href="index.html#productos">Productos</a></li>
                        <li><a href="index.html#nosotros">Nosotros</a></li>
                        <li><a href="index.html#contacto">Contacto</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Síguenos</h4>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Pastelería Mil Sabores. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Inicialización específica para la página de registro
        document.addEventListener('DOMContentLoaded', function() {
            updateCartDisplay();
            
            const registerForm = document.getElementById('registerForm');
            const promoCodeInput = document.getElementById('promoCode');
            const birthDateInput = document.getElementById('birthDate');
            const emailInput = document.getElementById('email');
            
            // Verificar código promocional en tiempo real
            promoCodeInput.addEventListener('input', checkPromoCode);
            birthDateInput.addEventListener('change', checkAge);
            emailInput.addEventListener('input', checkEmail);
            
            registerForm.addEventListener('submit', function(e) {
                e.preventDefault();
                handleRegister(e);
            });
        });

        function checkPromoCode() {
            const promoCodeInput = document.getElementById('promoCode');
            const discountInfo = document.getElementById('discountInfo');
            const code = promoCodeInput.value.trim();

            if (code === 'FELICES50') {
                discountInfo.innerHTML = '¡Código válido! Obtienes 10% de descuento de por vida';
                discountInfo.className = 'discount-info success';
                discountInfo.style.display = 'block';
            } else if (code && code !== 'FELICES50') {
                discountInfo.innerHTML = 'Código no válido';
                discountInfo.className = 'discount-info error';
                discountInfo.style.display = 'block';
            } else {
                discountInfo.style.display = 'none';
            }
        }

        function checkAge() {
            const birthDateInput = document.getElementById('birthDate');
            const discountInfo = document.getElementById('discountInfo');
            
            if (birthDateInput.value) {
                const age = calculateAge(new Date(birthDateInput.value));
                if (age >= 50) {
                    discountInfo.innerHTML = '¡Genial! Como mayor de 50 años obtienes 50% de descuento';
                    discountInfo.className = 'discount-info success';
                    discountInfo.style.display = 'block';
                }
            }
        }

        function checkEmail() {
            const emailInput = document.getElementById('email');
            const discountInfo = document.getElementById('discountInfo');
            
            if (emailInput.value.includes('@duocuc.cl')) {
                discountInfo.innerHTML = '¡Estudiante Duoc detectado! Torta gratis en tu cumpleaños';
                discountInfo.className = 'discount-info success';
                discountInfo.style.display = 'block';
            }
        }

        function handleRegister(e) {
            const formData = new FormData(e.target);
            const name = formData.get('fullName');
            const email = formData.get('email');
            const birthDate = formData.get('birthDate');
            const promoCode = formData.get('promoCode');
            const password = formData.get('password');
            const confirmPassword = formData.get('confirmPassword');

            // Validar contraseñas
            if (password !== confirmPassword) {
                alert('Las contraseñas no coinciden');
                return;
            }

            // Calcular edad y descuentos
            const age = calculateAge(new Date(birthDate));
            let discounts = [];

            if (age >= 50) {
                discounts.push({ type: 'age50', description: 'Descuento 50% por ser mayor de 50 años', percentage: 50 });
            }

            if (promoCode === 'FELICES50') {
                discounts.push({ type: 'promo', description: 'Descuento 10% de por vida', percentage: 10 });
            }

            if (email.includes('@duocuc.cl')) {
                discounts.push({ type: 'student', description: 'Torta gratis en cumpleaños (estudiante Duoc)', percentage: 0, special: 'birthday_cake' });
            }

            // Guardar usuario en localStorage
            const usuario = {
                name: name,
                email: email,
                birthDate: birthDate,
                discounts: discounts
            };
            localStorage.setItem('usuarioMilSabores', JSON.stringify(usuario));

            // Mostrar mensaje de éxito y datos en pantalla
            const discountInfo = document.getElementById('discountInfo');
            let message = '<strong>¡Registro exitoso!</strong><br><br>';
            message += `<b>Nombre:</b> ${name}<br>`;
            message += `<b>Email:</b> ${email}<br>`;
            message += `<b>Fecha de nacimiento:</b> ${birthDate}<br>`;
            if (discounts.length > 0) {
                message += '<b>Descuentos:</b><ul>';
                discounts.forEach(d => {
                    message += `<li>${d.description}</li>`;
                });
                message += '</ul>';
            }
            message += '<br>Redirigiendo...';

            discountInfo.innerHTML = message;
            discountInfo.className = 'discount-info success';
            discountInfo.style.display = 'block';

            // Redirigir después de 4 segundos
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 4000);
        }

        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        }
    </script>
</body>
</html>
